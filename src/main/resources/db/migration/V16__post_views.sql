CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE post_views
(
    id         UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    post_id    UUID      NOT NULL REFERENCES posts (id),
    user_id    UUID REFERENCES users (id),
    ip_address TEXT,
    viewed_at  TIMESTAMP NOT NULL DEFAULT now()
);

CREATE INDEX idx_post_views_post ON post_views(post_id);
CREATE INDEX idx_post_views_user_post_time ON post_views(user_id, post_id, viewed_at);

ALTER TABLE post_categories
    ALTER COLUMN id SET DEFAULT uuid_generate_v4();

INSERT INTO post_categories (name, created_by, updated_by)
VALUES
    ('EDUCATION', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('MUSIC', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('ENTERTAINMENT', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('TECHNOLOGY', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('SPORTS', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('HEALTH', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('BUSINESS', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('SCIENCE', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('FOOD', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000'),
    ('TRAVEL', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000');

